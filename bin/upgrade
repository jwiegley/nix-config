#!/usr/bin/env bash

case $1 in
    vulcan)
        u vulcan upgrade sign
        # notify "Nix on Vulcan upgraded"
        ;;

    hermes)
        u hermes upgrade-tasks check
        # notify "Nix on Hermes upgraded"
        ;;

    hera)
        u hera upgrade sign copy
        # notify "Nix on Hera upgraded"
        ;;

    clio)
        u clio upgrade-tasks check
        # notify "Nix on Clio upgraded"
        ;;

    athena)
        u switch check
        eval "$(/opt/homebrew/bin/brew shellenv)"
        brew update
        brew upgrade --greedy
        # notify "Nix on Athena upgraded"
        exit 0
        ;;

    *)
        echo "Unrecognized hostname: $1"
        exit 1
        ;;
esac

### Kadena projects

(
    cd ~/kadena/pact-fv
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --enable-tests --disable-profiling --disable-executable-profiling
    cabal v2-build
    cabal v2-test
)

(
    cd ~/kadena/evm/reth
    rm .envrc* ; de ; source .envrc
    cargo update
    cargo build
    cargo test
    cargo doc
    cargo clippy
)

### Coq projects

(
    cd ~/src/category-theory
    rm .envrc* ; de ; source .envrc
    make clean
    make
)

(
    cd ~/src/ltl/coq
    rm .envrc* ; de ; source .envrc
    make clean
    make
)

### Haskell projects

(
    cd ~/src/notes/haskell
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --disable-tests --disable-profiling --disable-executable-profiling
)

(
    cd ~/src/org-jw
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --enable-tests --enable-profiling --enable-executable-profiling
    cabal v2-build all
)

(
    cd ~/src/renamer
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --enable-tests --enable-profiling --enable-executable-profiling
    cabal v2-build
    cabal v2-test
)

(
    cd ~/src/simple-amount
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --enable-tests --disable-profiling --disable-executable-profiling
    cabal v2-build
    cabal v2-test
)

(
    cd ~/src/three-partition
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --enable-tests --disable-profiling --disable-executable-profiling
    cabal v2-build
    cabal v2-test
)

(
    cd ~/src/trade-journal
    rm .envrc* ; de ; source .envrc
    cabal v2-update
    cabal v2-configure --enable-tests --disable-profiling --disable-executable-profiling
    cabal v2-build
    cabal v2-test
)

### Rust projects

(
    cd ~/src/comparable
    rm .envrc* ; de ; source .envrc
    cargo update
    cargo build
    cargo test
    cargo doc
    cargo clippy
)
